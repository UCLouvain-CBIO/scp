<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compute q-values — pep2qvalue • scp</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Compute q-values — pep2qvalue"><meta property="og:description" content="This function computes q-values from the posterior error
probabilities (PEPs). The functions takes the PEPs from the given
assay's rowData and adds a new variable to it that contains the
computed q-values."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">scp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.17.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/scp.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/advanced.html">Advanced usage of `scp`</a>
    </li>
    <li>
      <a href="../articles/QFeatures_nutshell.html">QFeatures in a nutshell</a>
    </li>
    <li>
      <a href="../articles/read_scp.html">Load Single-Cell Proteomics data using `readSCP`</a>
    </li>
    <li>
      <a href="../articles/reporting_missing_values.html">Reporting missing values for Single Cell Proteomics</a>
    </li>
    <li>
      <a href="../articles/scp_data_modelling.html">Single Cell Proteomics data modelling</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/UCLouvain-CBIO/scp/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute q-values</h1>
    <small class="dont-index">Source: <a href="https://github.com/UCLouvain-CBIO/scp/blob/master/R/compute_metrics.R" class="external-link"><code>R/compute_metrics.R</code></a></small>
    <div class="hidden name"><code>pep2qvalue.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function computes q-values from the posterior error
probabilities (PEPs). The functions takes the PEPs from the given
assay's <code>rowData</code> and adds a new variable to it that contains the
computed q-values.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pep2qvalue</span><span class="op">(</span><span class="va">object</span>, <span class="va">i</span>, <span class="va">groupBy</span>, <span class="va">PEP</span>, rowDataName <span class="op">=</span> <span class="st">"qvalue"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>A <code>QFeatures</code> object</p></dd>


<dt id="arg-i">i<a class="anchor" aria-label="anchor" href="#arg-i"></a></dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code> or <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> vector indicating from
which assays the <code>rowData</code> should be taken.</p></dd>


<dt id="arg-groupby">groupBy<a class="anchor" aria-label="anchor" href="#arg-groupby"></a></dt>
<dd><p>A <code>character(1)</code> indicating the variable name in
the <code>rowData</code> that contains the grouping variable, for
instance to compute protein FDR. When <code>groupBy</code> is not missing,
the best feature approach is used to compute the PEP per group,
meaning that the smallest PEP is taken as the PEP of the group.</p></dd>


<dt id="arg-pep">PEP<a class="anchor" aria-label="anchor" href="#arg-pep"></a></dt>
<dd><p>A <code>character(1)</code> indicating the variable names in the
<code>rowData</code> that contains the PEPs. Since, PEPs are probabilities, the
variable must be contained in (0, 1).</p></dd>


<dt id="arg-rowdataname">rowDataName<a class="anchor" aria-label="anchor" href="#arg-rowdataname"></a></dt>
<dd><p>A <code>character(1)</code> giving the name of the new
variable in the <code>rowData</code> where the computed FDRs will be
stored. The name cannot already exist in any of the assay
<code>rowData</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A <code>QFeatures</code> object.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The q-value of a feature (PSM, peptide, protein) is the minimum
FDR at which that feature will be selected upon filtering
(Savitski et al.). On the other hand, the feature PEP is the
probability that the feature is wrongly matched and hence can be
seen as a local FDR (Kall et al.). While filtering on PEP is
guaranteed to control for FDR, it is usually too conservative.
Therefore, we provide this function to convert PEP to q-values.</p>
<p>We compute the q-value of a feature as the average of the PEPs
associated to PSMs that have equal or greater identification
confidence (so smaller PEP). See Kall et al. for a visual
interpretation.</p>
<p>We also allow inference of q-values at higher level, for instance
computing the protein q-values from PSM PEP. This can be performed
by supplying the <code>groupBy</code> argument. In this case, we adopt the
best feature strategy that will take the best (smallest) PEP for
each group (Savitski et al.).</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Käll, Lukas, John D. Storey, Michael J. MacCoss, and William
Stafford Noble. 2008. “Posterior Error Probabilities and False
Discovery Rates: Two Sides of the Same Coin.” Journal of Proteome
Research 7 (1): 40–44.</p>
<p>Savitski, Mikhail M., Mathias Wilhelm, Hannes Hahne, Bernhard
Kuster, and Marcus Bantscheff. 2015. “A Scalable Approach for
Protein False Discovery Rate Estimation in Large Proteomic Data
Sets.” Molecular &amp; Cellular Proteomics: MCP 14 (9): 2394–2404.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"scp1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">scp1</span> <span class="op">&lt;-</span> <span class="fu">pep2qvalue</span><span class="op">(</span><span class="va">scp1</span>,</span></span>
<span class="r-in"><span>                   i <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                   groupBy <span class="op">=</span> <span class="st">"protein"</span>,</span></span>
<span class="r-in"><span>                   PEP <span class="op">=</span> <span class="st">"dart_PEP"</span>,</span></span>
<span class="r-in"><span>                   rowDataName <span class="op">=</span> <span class="st">"qvalue_protein"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Check results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="va">scp1</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dart_PEP"</span>, <span class="st">"qvalue_protein"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 166 rows and 2 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              dart_PEP qvalue_protein</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             &lt;numeric&gt;      &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PSM3773   7.78683e-05    1.24198e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PSM9078   3.51840e-01    7.55061e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PSM9858   1.54857e-04    7.83117e-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PSM11744  1.00000e+00    2.28967e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PSM21752  3.42850e-01    5.52325e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...               ...            ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PSM732069 4.89848e-05    4.41181e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PSM735396 3.89829e-07    1.24198e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PSM744756 1.54479e-06    7.82514e-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PSM745037 4.44010e-01    1.14849e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PSM745130 2.07957e-04    1.83409e-10</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Christophe Vanderaa, Laurent Gatto.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

      </footer></div>






  </body></html>

